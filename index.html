<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>心灵港湾 - 抑郁症治疗助手</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/luxon@2.0.2"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>
	<style>
		:root {
			--primary-color: #5e72e4;
			--secondary-color: #f7fafc;
			--accent-color: #667eea;
			--text-color: #2d3748;
			--light-text: #f8f9fa;
			--glass-bg: rgba(255, 255, 255, 0.15);
			--glass-border: rgba(255, 255, 255, 0.18);
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
		}

		body {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: var(--text-color);
			min-height: 100vh;
			overflow-x: hidden;
			animation: fadeIn 1.5s ease-out;
		}

		@keyframes fadeIn {
			from { opacity: 0; }
			to { opacity: 1; }
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
		}

		header {
			text-align: center;
			margin-bottom: 30px;
			color: var(--light-text);
			animation: slideDown 1s ease-out;
		}

		@keyframes slideDown {
			from { transform: translateY(-50px); opacity: 0; }
			to { transform: translateY(0); opacity: 1; }
		}

		h1 {
			font-size: 2.5rem;
			margin-bottom: 10px;
			font-weight: 300;
			text-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.subtitle {
			font-size: 1.2rem;
			opacity: 0.8;
		}

		.card {
			background: var(--glass-bg);
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			border-radius: 15px;
			padding: 25px;
			margin-bottom: 30px;
			box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
			border: 1px solid var(--glass-border);
			transition: transform 0.3s ease, box-shadow 0.3s ease;
			color: var(--light-text);
		}

		.card:hover {
			transform: translateY(-5px);
			box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.3);
		}

		.card-title {
			font-size: 1.5rem;
			margin-bottom: 20px;
			font-weight: 400;
			border-bottom: 1px solid rgba(255,255,255,0.1);
			padding-bottom: 10px;
		}

		.tab-container {
			display: flex;
			margin-bottom: 20px;
			border-bottom: 1px solid rgba(255,255,255,0.1);
		}

		.tab {
			padding: 10px 20px;
			cursor: pointer;
			transition: all 0.3s ease;
			border-bottom: 3px solid transparent;
		}

		.tab:hover {
			background: rgba(255,255,255,0.1);
		}

		.tab.active {
			border-bottom: 3px solid var(--light-text);
			font-weight: 500;
		}

		.tab-content {
			display: none;
		}

		.tab-content.active {
			display: block;
			animation: fadeIn 0.5s ease-out;
		}

		.breathing-circle {
			width: 200px;
			height: 200px;
			border-radius: 50%;
			background: rgba(255,255,255,0.2);
			margin: 30px auto;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 1.5rem;
			color: white;
			animation: pulse 8s infinite ease-in-out;
			transition: all 0.3s ease;
			cursor: pointer;
		}

		@keyframes pulse {
			0%, 100% { transform: scale(0.9); background: rgba(255,255,255,0.2); }
			50% { transform: scale(1.1); background: rgba(255,255,255,0.4); }
		}

		.breathing-instruction {
			text-align: center;
			margin-bottom: 20px;
			line-height: 1.6;
		}

		.btn {
			background: rgba(255,255,255,0.2);
			border: none;
			color: white;
			padding: 12px 25px;
			border-radius: 30px;
			cursor: pointer;
			transition: all 0.3s ease;
			font-size: 1rem;
			outline: none;
			margin: 5px;
			backdrop-filter: blur(5px);
		}

		.btn:hover {
			background: rgba(255,255,255,0.3);
			transform: translateY(-2px);
		}

		.btn-primary {
			background: rgba(255,255,255,0.3);
			font-weight: 500;
		}

		.btn-primary:hover {
			background: rgba(255,255,255,0.4);
		}

		.quote-container {
			margin: 20px 0;
			padding: 20px;
			background: rgba(255,255,255,0.1);
			border-radius: 10px;
			position: relative;
		}

		.quote-text {
			font-style: italic;
			font-size: 1.1rem;
			line-height: 1.6;
			margin-bottom: 10px;
		}

		.quote-author {
			text-align: right;
			font-weight: 500;
		}

		.mood-selector {
			display: flex;
			justify-content: space-between;
			margin: 20px 0;
		}

		.mood-option {
			text-align: center;
			cursor: pointer;
			transition: all 0.3s ease;
			padding: 10px;
			border-radius: 10px;
		}

		.mood-option:hover {
			background: rgba(255,255,255,0.1);
		}

		.mood-option.selected {
			background: rgba(255,255,255,0.2);
			transform: scale(1.05);
		}

		.mood-icon {
			font-size: 2rem;
			margin-bottom: 5px;
		}

		.mood-label {
			font-size: 0.9rem;
		}

		.note-input {
			width: 100%;
			background: rgba(255,255,255,0.1);
			border: none;
			border-radius: 10px;
			padding: 15px;
			color: white;
			margin: 15px 0;
			resize: none;
			outline: none;
		}

		.note-input::placeholder {
			color: rgba(255,255,255,0.6);
		}

		.history-item {
			background: rgba(255,255,255,0.1);
			border-radius: 10px;
			padding: 15px;
			margin-bottom: 10px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			transition: all 0.3s ease;
		}

		.history-item:hover {
			background: rgba(255,255,255,0.2);
		}

		.history-date {
			font-size: 0.9rem;
			opacity: 0.8;
		}

		.history-mood {
			font-weight: 500;
		}

		.chart-container {
			position: relative;
			height: 300px;
			margin-top: 30px;
		}

		.question-item {
			margin-bottom: 20px;
		}

		.question-text {
			margin-bottom: 10px;
			font-weight: 500;
		}

		.option-item {
			margin-bottom: 8px;
		}

		.option-label {
			display: flex;
			align-items: center;
			cursor: pointer;
		}

		.option-radio {
			margin-right: 10px;
		}

		.test-result {
			margin-top: 20px;
			padding: 15px;
			background: rgba(255,255,255,0.1);
			border-radius: 10px;
			display: none;
		}

		.chat-container {
			height: 300px;
			overflow-y: auto;
			margin-bottom: 15px;
			padding: 10px;
			background: rgba(255,255,255,0.1);
			border-radius: 10px;
		}

		.message {
			margin-bottom: 10px;
			padding: 10px 15px;
			border-radius: 15px;
			max-width: 80%;
			word-wrap: break-word;
		}

		.user-message {
			background: rgba(255,255,255,0.2);
			margin-left: auto;
			border-bottom-right-radius: 5px;
		}

		.bot-message {
			background: rgba(255,255,255,0.1);
			margin-right: auto;
			border-bottom-left-radius: 5px;
		}

		.chat-input-container {
			display: flex;
		}

		.chat-input {
			flex-grow: 1;
			background: rgba(255,255,255,0.1);
			border: none;
			border-radius: 20px;
			padding: 12px 15px;
			color: white;
			outline: none;
		}

		.chat-input::placeholder {
			color: rgba(255,255,255,0.6);
		}

		.send-btn {
			background: rgba(255,255,255,0.2);
			border: none;
			color: white;
			border-radius: 50%;
			width: 40px;
			height: 40px;
			margin-left: 10px;
			cursor: pointer;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.send-btn:hover {
			background: rgba(255,255,255,0.3);
		}

		.loading {
			display: inline-block;
			width: 20px;
			height: 20px;
			border: 3px solid rgba(255,255,255,0.3);
			border-radius: 50%;
			border-top-color: white;
			animation: spin 1s ease-in-out infinite;
			margin-left: 10px;
		}

		@keyframes spin {
			to { transform: rotate(360deg); }
		}

		/* 音乐播放器样式 */
		.music-player {
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: var(--glass-bg);
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			border-radius: 30px;
			padding: 10px 20px;
			display: flex;
			align-items: center;
			box-shadow: 0 4px 16px rgba(0,0,0,0.2);
			z-index: 100;
			border: 1px solid var(--glass-border);
		}

		.music-controls {
			display: flex;
			align-items: center;
		}

		.music-btn {
			background: none;
			border: none;
			color: white;
			font-size: 1.2rem;
			cursor: pointer;
			margin: 0 10px;
			outline: none;
			transition: all 0.3s ease;
		}

		.music-btn:hover {
			transform: scale(1.1);
		}

		.music-info {
			margin-left: 15px;
			font-size: 0.9rem;
			max-width: 200px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		footer {
			text-align: center;
			margin-top: 50px;
			color: rgba(255,255,255,0.6);
			font-size: 0.9rem;
			padding-bottom: 80px; /* 为音乐播放器留出空间 */
		}

		/* Responsive adjustments */
		@media (max-width: 768px) {
			.container {
				padding: 15px;
			}
			
			h1 {
				font-size: 2rem;
			}
			
			.card {
				padding: 20px;
			}
			
			.breathing-circle {
				width: 150px;
				height: 150px;
			}
			
			.mood-selector {
				flex-wrap: wrap;
				justify-content: center;
			}
			
			.mood-option {
				width: 25%;
				margin-bottom: 10px;
			}
			
			.music-player {
				width: 90%;
				padding: 8px 15px;
			}
			
			.music-info {
				max-width: 120px;
			}
		}

		@media (max-width: 480px) {
			.tab {
				padding: 8px 12px;
				font-size: 0.9rem;
			}
			
			.mood-option {
				width: 33%;
			}
			
			.music-player {
				bottom: 10px;
				padding: 6px 12px;
			}
			
			.music-btn {
				margin: 0 5px;
				font-size: 1rem;
			}
			
			.music-info {
				font-size: 0.8rem;
				max-width: 100px;
			}
		}
	</style>
</head>
<body>
	<audio id="bgMusic">
		<source src="https://er-sycdn.kuwo.cn/40597672e625ea45cb41da6a5dd665f1/68b96c0b/resource/30106/trackmedia/M500001a3QpG0HsOAP.mp3?bitrate$128&from=vip" type="audio/mpeg">
	</audio>

	<div class="container">
		<header>
			<h1>心灵港湾</h1>
			<p class="subtitle">您的抑郁症治疗助手</p>
		</header>

		<div class="tab-container">
			<div class="tab active" data-tab="meditation">呼吸冥想</div>
			<div class="tab" data-tab="quotes">名人寄语</div>
			<div class="tab" data-tab="mood">情绪记录</div>
			<div class="tab" data-tab="test">自评测试</div>
			<div class="tab" data-tab="chat">心理咨询</div>
		</div>

		<!-- 呼吸冥想 -->
		<div class="tab-content active" id="meditation">
			<div class="card">
				<h2 class="card-title">呼吸冥想练习</h2>
				<p class="breathing-instruction">
					深呼吸可以帮助缓解焦虑和抑郁症状。<br>
					点击下面的圆圈开始呼吸练习，跟随动画节奏呼吸。<br>
					吸气时圆圈会变大，呼气时圆圈会变小。
				</p>
				<div class="breathing-circle" id="breathingCircle">点击开始</div>
				<div class="text-center">
					<button class="btn btn-primary" id="resetBreathing">重置</button>
				</div>
			</div>
		</div>

		<!-- 名人寄语 -->
		<div class="tab-content" id="quotes">
			<div class="card">
				<h2 class="card-title">名人寄语</h2>
				<div id="quoteDisplay">
					<div class="quote-container">
						<p class="quote-text">"生活就像海洋，只有意志坚强的人才能到达彼岸。"</p>
						<p class="quote-author">—— 马克思</p>
					</div>
				</div>
				<div class="text-center">
					<button class="btn btn-primary" id="newQuote">新的寄语</button>
				</div>
			</div>
		</div>

		<!-- 情绪记录 -->
		<div class="tab-content" id="mood">
			<div class="card">
				<h2 class="card-title">记录今日情绪</h2>
				<div class="mood-selector" id="moodSelector">
					<div class="mood-option" data-mood="5">
						<div class="mood-icon">😄</div>
						<div class="mood-label">非常开心</div>
					</div>
					<div class="mood-option" data-mood="4">
						<div class="mood-icon">😊</div>
						<div class="mood-label">开心</div>
					</div>
					<div class="mood-option" data-mood="3">
						<div class="mood-icon">😐</div>
						<div class="mood-label">一般</div>
					</div>
					<div class="mood-option" data-mood="2">
						<div class="mood-icon">😞</div>
						<div class="mood-label">低落</div>
					</div>
					<div class="mood-option" data-mood="1">
						<div class="mood-icon">😢</div>
						<div class="mood-label">非常低落</div>
					</div>
				</div>
				<textarea class="note-input" id="moodNote" placeholder="记录下今天的心情和想法..."></textarea>
				<div class="text-center">
					<button class="btn btn-primary" id="saveMood">保存记录</button>
					<button class="btn" id="showHistory">查看历史</button>
				</div>
				
				<div id="historyContainer" style="display: none;">
					<h3 class="card-title" style="margin-top: 20px;">情绪记录历史</h3>
					<div id="historyList"></div>
				</div>
				
				<div class="chart-container">
					<canvas id="moodChart"></canvas>
				</div>
			</div>
		</div>

		<!-- 自评测试 -->
		<div class="tab-content" id="test">
			<div class="card">
				<h2 class="card-title">抑郁症自评量表 (PHQ-9)</h2>
				<p style="margin-bottom: 20px;">请根据过去两周的情况，回答以下问题：</p>
				
				<div id="testQuestions">
					<div class="question-item">
						<p class="question-text">1. 做事时提不起劲或没有兴趣</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q1" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q1" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q1" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q1" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">2. 感到心情低落、沮丧或绝望</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q2" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q2" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q2" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q2" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">3. 入睡困难、睡不安稳或睡眠过多</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q3" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q3" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q3" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q3" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">4. 感觉疲倦或没有活力</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q4" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q4" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q4" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q4" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">5. 食欲不振或吃太多</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q5" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q5" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q5" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q5" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">6. 觉得自己很糟或觉得自己很失败，或让自己或家人失望</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q6" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q6" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q6" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q6" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">7. 对事物专注有困难，例如阅读报纸或看电视时</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q7" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q7" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q7" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q7" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">8. 动作或说话速度缓慢到别人已经察觉？或正好相反，烦躁或坐立不安、动来动去的情况更胜于平常</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q8" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q8" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q8" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q8" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
					
					<div class="question-item">
						<p class="question-text">9. 有不如死掉或用某种方式伤害自己的念头</p>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q9" value="0" class="option-radio"> 完全没有 (0分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q9" value="1" class="option-radio"> 有几天 (1分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q9" value="2" class="option-radio"> 一半以上时间 (2分)
							</label>
						</div>
						<div class="option-item">
							<label class="option-label">
								<input type="radio" name="q9" value="3" class="option-radio"> 几乎每天 (3分)
							</label>
						</div>
					</div>
				</div>
				
				<div class="text-center">
					<button class="btn btn-primary" id="submitTest">提交测试</button>
				</div>
				
				<div class="test-result" id="testResult">
					<h3 class="card-title">测试结果</h3>
					<p id="resultText"></p>
					<p id="resultSuggestion"></p>
				</div>
			</div>
		</div>

		<!-- 心理咨询 -->
		<div class="tab-content" id="chat">
			<div class="card">
				<h2 class="card-title">心理咨询</h2>
				<p style="margin-bottom: 20px;">您可以在这里与我们的专业心理咨询师交流。</p>
				
				<div class="chat-container" id="chatContainer">
					<div class="message bot-message">
						您好，我是KSF心理咨询师。请问有什么可以帮助您的吗？
					</div>
				</div>
				
				<div class="chat-input-container">
					<input type="text" class="chat-input" id="chatInput" placeholder="输入您的问题...">
					<button class="send-btn" id="sendMessage">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<line x1="22" y1="2" x2="11" y2="13"></line>
							<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
						</svg>
					</button>
				</div>
			</div>
		</div>

		<footer>
			<p>心灵港湾 © 2023 - 您的心理健康伙伴</p>
		</footer>
	</div>

	<!-- 音乐播放器 -->
	<div class="music-player">
		<div class="music-controls">
			<button class="music-btn" id="prevSong">⏮</button>
			<button class="music-btn" id="playPause">⏯</button>
			<button class="music-btn" id="nextSong">⏭</button>
		</div>
		<div class="music-info" id="musicInfo">背景音乐</div>
	</div>

	<script>
		// 全局变量
		let moodChart;
		let selectedMood = null;
		let isBreathing = false;
		let breathingInterval;
		let currentQuoteIndex = 0;
		
		// 名人名言库
		const quotes = [
			{
				text: "生活就像海洋，只有意志坚强的人才能到达彼岸。",
				author: "马克思"
			},
			{
				text: "世界上只有一种真正的英雄主义，那就是在认清生活的真相后依然热爱生活。",
				author: "罗曼·罗兰"
			},
			{
				text: "生命中最伟大的光辉不在于永不坠落，而在于坠落后总能再度升起。",
				author: "曼德拉"
			},
			{
				text: "黑夜无论怎样悠长，白昼总会到来。",
				author: "莎士比亚"
			},
			{
				text: "一个人可以被毁灭，但不能被打败。",
				author: "海明威"
			},
			{
				text: "生活不可能像你想象得那么好，但也不会像你想象得那么糟。",
				author: "莫泊桑"
			},
			{
				text: "当你凝视深渊时，深渊也在凝视着你。",
				author: "尼采"
			},
			{
				text: "人生的道路虽然漫长，但紧要处常常只有几步。",
				author: "柳青"
			},
			{
				text: "希望是附丽于存在的，有存在，便有希望，有希望，便是光明。",
				author: "鲁迅"
			},
			{
				text: "世界上只有一种真正的英雄主义，那就是在认清生活的真相后依然热爱生活。",
				author: "罗曼·罗兰"
			}
		];

		// 抑郁症测试结果解释
		const testResults = [
			{
				scoreRange: [0, 4],
				text: "您的抑郁症状很轻微，可能不需要治疗。",
				suggestion: "继续保持积极的生活方式，关注自己的情绪变化。"
			},
			{
				scoreRange: [5, 9],
				text: "您有轻度抑郁症状。",
				suggestion: "建议关注自己的情绪变化，可以考虑与心理咨询师交流。"
			},
			{
				scoreRange: [10, 14],
				text: "您有中度抑郁症状。",
				suggestion: "建议寻求专业帮助，心理咨询或考虑药物治疗。"
			},
			{
				scoreRange: [15, 19],
				text: "您有中重度抑郁症状。",
				suggestion: "强烈建议尽快寻求专业心理治疗或精神科医生的帮助。"
			},
			{
				scoreRange: [20, 27],
				text: "您有重度抑郁症状。",
				suggestion: "请立即寻求专业医疗帮助，这种情况需要及时治疗。"
			}
		];

		// 音乐播放器相关变量
		const musicList = [
			{
				url: "http://m801.music.126.net/20250905113128/8c2ad6669ee4c31e6596ef4457ea0cd0/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/44071033997/8930/770d/38dc/999dcd8132fdfadbc7739f83c9a13a92.mp3?vuutv=heK1HmBMjwWSpgoh2zm9d9//VHuCf6+F6M8CAVvAQ57ffQv7FpNOS56d9VrcZwoDi+02paEQxU6/rzItYw3j5T+caWUFbAuNiOqHdtnxKhE=",
				title: "放松音乐1"
			},
			{
				url: "http://m701.music.126.net/20250905112958/fcf2283bb2c6de2b25f37e828a701f70/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/18721377009/c3ed/abdd/30ea/3dfed8d70ee667f9cfc81af776a9004e.flac?vuutv=ttwIsU6TMCNcaAzGjWB+mM1d5O5b/eBR3zlILt1KGg6vmyoW/XqkFJae8n2bLppIvzj1bdvqKzJ7YREMzKmOOenUZhb3BFfyTDurnWe0U+s=",
				title: "放松音乐2"
			},
			{
				url: "http://m801.music.126.net/20250905112517/51dc1772fc4fd2cb03b61cd7ed0e33c5/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/28558871037/2bd9/aac7/aec3/042653adf547fc7c08e0ab690442dd60.flac?vuutv=r9nPCVt2ebjRmOZlkMnipC3VcNDll+JzgFpxTBJJJg3EpFwaDl5tzdw+FsaPvcoFUZ5/1klPkf8vW7TQyTm2QjQM0wc96+FqcEFNcmyQ9Ow=",
				title: "放松音乐3"
			},
			{
				url: "http://m801.music.126.net/20250905112404/6017ea6b7775f46f2b64ab07a1711621/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/28558885698/afdd/3278/f490/923689b6c41eb8bd8d8ccd008b544954.flac?vuutv=3HcO+i0fSdaRYqT72SH0H67stgUIFsJF2RqRE+5TV5FgiaGlZGz/yTt/6erudmlOhEINx7UzV52VOBhBcvrx6gGRFBLTjC3+3xFfw9I/yHA=",
				title: "放松音乐4"
			}
		];
		let currentMusicIndex = 0;
		let isMusicPlaying = false;

		// DOM加载完成后执行
		document.addEventListener('DOMContentLoaded', function() {
			// 初始化音乐播放器
			const bgMusic = document.getElementById('bgMusic');
			const playPauseBtn = document.getElementById('playPause');
			const prevSongBtn = document.getElementById('prevSong');
			const nextSongBtn = document.getElementById('nextSong');
			const musicInfo = document.getElementById('musicInfo');
			
			// 设置第一首音乐
			updateMusicInfo();
			
			// 播放/暂停按钮
			playPauseBtn.addEventListener('click', function() {
				if (isMusicPlaying) {
					bgMusic.pause();
					isMusicPlaying = false;
				} else {
					bgMusic.play().catch(e => console.log("音乐播放错误"));
					isMusicPlaying = true;
				}
				updatePlayPauseIcon();
			});
			
			// 上一首按钮
			prevSongBtn.addEventListener('click', function() {
				currentMusicIndex = (currentMusicIndex - 1 + musicList.length) % musicList.length;
				changeMusic();
			});
			
			// 下一首按钮
			nextSongBtn.addEventListener('click', function() {
				currentMusicIndex = (currentMusicIndex + 1) % musicList.length;
				changeMusic();
			});
			
			// 音乐结束自动播放下一首
			bgMusic.addEventListener('ended', function() {
				currentMusicIndex = (currentMusicIndex + 1) % musicList.length;
				changeMusic();
			});
			
			// 尝试自动播放音乐
			bgMusic.volume = 0.3;
			bgMusic.play().catch(e => {
				console.log("自动播放被阻止，请点击页面后音乐将自动播放");
				isMusicPlaying = false;
				updatePlayPauseIcon();
			});
			
			// 点击页面后播放音乐（解决浏览器自动播放限制）
			document.body.addEventListener('click', function() {
				if (!isMusicPlaying) {
					bgMusic.play().catch(e => console.log("音乐播放错误"));
					isMusicPlaying = true;
					updatePlayPauseIcon();
				}
			}, { once: true });

			// 标签切换功能
			const tabs = document.querySelectorAll('.tab');
			tabs.forEach(tab => {
				tab.addEventListener('click', function() {
					// 移除所有active类
					tabs.forEach(t => t.classList.remove('active'));
					document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
					
					// 添加active类
					this.classList.add('active');
					const tabId = this.getAttribute('data-tab');
					document.getElementById(tabId).classList.add('active');
					
					// 如果是情绪记录标签，更新图表
					if (tabId === 'mood') {
						updateMoodChart();
					}
				});
			});

			// 呼吸冥想功能
			const breathingCircle = document.getElementById('breathingCircle');
			const resetBreathingBtn = document.getElementById('resetBreathing');
			
			breathingCircle.addEventListener('click', function() {
				if (isBreathing) {
					stopBreathing();
				} else {
					startBreathing();
				}
			});
			
			resetBreathingBtn.addEventListener('click', function() {
				stopBreathing();
				breathingCircle.style.animation = 'none';
				breathingCircle.style.transform = 'scale(1)';
				breathingCircle.style.background = 'rgba(255,255,255,0.2)';
				breathingCircle.textContent = '点击开始';
				isBreathing = false;
			});

			// 名人寄语功能
			const newQuoteBtn = document.getElementById('newQuote');
			newQuoteBtn.addEventListener('click', showRandomQuote);
			
			// 初始显示一条名言
			showRandomQuote();

			// 情绪选择功能
			const moodOptions = document.querySelectorAll('.mood-option');
			moodOptions.forEach(option => {
				option.addEventListener('click', function() {
					moodOptions.forEach(opt => opt.classList.remove('selected'));
					this.classList.add('selected');
					selectedMood = parseInt(this.getAttribute('data-mood'));
				});
			});

			// 保存情绪记录
			const saveMoodBtn = document.getElementById('saveMood');
			saveMoodBtn.addEventListener('click', saveMoodRecord);
			
			// 显示历史记录
			const showHistoryBtn = document.getElementById('showHistory');
			showHistoryBtn.addEventListener('click', toggleHistory);

			// 初始化情绪图表
			initMoodChart();
			
			// 加载历史记录
			loadMoodHistory();

			// 抑郁症测试提交
			const submitTestBtn = document.getElementById('submitTest');
			submitTestBtn.addEventListener('click', calculateTestResult);

			// 聊天功能
			const sendMessageBtn = document.getElementById('sendMessage');
			const chatInput = document.getElementById('chatInput');
			
			sendMessageBtn.addEventListener('click', sendChatMessage);
			chatInput.addEventListener('keypress', function(e) {
				if (e.key === 'Enter') {
					sendChatMessage();
				}
			});
		});

		// 音乐播放器功能
		function changeMusic() {
			const bgMusic = document.getElementById('bgMusic');
			bgMusic.src = musicList[currentMusicIndex].url;
			updateMusicInfo();
			
			if (isMusicPlaying) {
				bgMusic.play().catch(e => console.log("音乐播放错误"));
			}
		}
		
		function updateMusicInfo() {
			const musicInfo = document.getElementById('musicInfo');
			musicInfo.textContent = musicList[currentMusicIndex].title;
		}
		
		function updatePlayPauseIcon() {
			const playPauseBtn = document.getElementById('playPause');
			playPauseBtn.textContent = isMusicPlaying ? '⏸' : '▶';
		}

		// 呼吸冥想功能
		function startBreathing() {
			const circle = document.getElementById('breathingCircle');
			circle.style.animation = 'pulse 8s infinite ease-in-out';
			circle.textContent = '吸气...呼气...';
			isBreathing = true;
		}

		function stopBreathing() {
			const circle = document.getElementById('breathingCircle');
			circle.style.animation = 'none';
			isBreathing = false;
		}

		// 名人名言功能
		function showRandomQuote() {
			const quoteDisplay = document.getElementById('quoteDisplay');
			
			// 确保不重复显示相同的名言
			let newIndex;
			do {
				newIndex = Math.floor(Math.random() * quotes.length);
			} while (newIndex === currentQuoteIndex && quotes.length > 1);
			
			currentQuoteIndex = newIndex;
			const quote = quotes[currentQuoteIndex];
			
			quoteDisplay.innerHTML = `
				<div class="quote-container">
					<p class="quote-text">"${quote.text}"</p>
					<p class="quote-author">—— ${quote.author}</p>
				</div>
			`;
		}

		// 情绪记录功能
		function saveMoodRecord() {
			if (!selectedMood) {
				alert('请选择您今天的情绪');
				return;
			}
			
			const note = document.getElementById('moodNote').value;
			const now = new Date();
			const dateStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString().substring(0, 5);
			
			const record = {
				date: dateStr,
				timestamp: now.getTime(),
				mood: selectedMood,
				note: note
			};
			
			// 获取现有记录
			let records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
			records.push(record);
			
			// 保存到本地存储
			localStorage.setItem('moodRecords', JSON.stringify(records));
			
			// 清空输入
			document.getElementById('moodNote').value = '';
			document.querySelector('.mood-option.selected')?.classList.remove('selected');
			selectedMood = null;
			
			// 更新图表和历史记录
			updateMoodChart();
			loadMoodHistory();
			
			alert('情绪记录已保存');
		}

		function toggleHistory() {
			const historyContainer = document.getElementById('historyContainer');
			const showHistoryBtn = document.getElementById('showHistory');
			
			if (historyContainer.style.display === 'none') {
				historyContainer.style.display = 'block';
				showHistoryBtn.textContent = '隐藏历史';
				loadMoodHistory();
			} else {
				historyContainer.style.display = 'none';
				showHistoryBtn.textContent = '查看历史';
			}
		}

		function loadMoodHistory() {
			const records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
			const historyList = document.getElementById('historyList');
			
			if (records.length === 0) {
				historyList.innerHTML = '<p>暂无历史记录</p>';
				return;
			}
			
			// 按日期排序
			records.sort((a, b) => b.timestamp - a.timestamp);
			
			let html = '';
			records.forEach(record => {
				const moodText = getMoodText(record.mood);
				const moodEmoji = getMoodEmoji(record.mood);
				
				html += `
					<div class="history-item">
						<div>
							<span class="history-date">${record.date}</span>
							<span class="history-mood">${moodEmoji} ${moodText}</span>
						</div>
						<div>${record.note || '无备注'}</div>
					</div>
				`;
			});
			
			historyList.innerHTML = html;
		}

		function getMoodText(moodValue) {
			switch(moodValue) {
				case 1: return '非常低落';
				case 2: return '低落';
				case 3: return '一般';
				case 4: return '开心';
				case 5: return '非常开心';
				default: return '未知';
			}
		}

		function getMoodEmoji(moodValue) {
			switch(moodValue) {
				case 1: return '😢';
				case 2: return '😞';
				case 3: return '😐';
				case 4: return '😊';
				case 5: return '😄';
				default: return '❓';
			}
		}

		// 情绪图表功能
		function initMoodChart() {
			const ctx = document.getElementById('moodChart').getContext('2d');
			
			moodChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: [],
					datasets: [{
						label: '情绪变化',
						data: [],
						borderColor: 'rgba(255, 255, 255, 0.8)',
						backgroundColor: 'rgba(255, 255, 255, 0.1)',
						tension: 0.4,
						fill: true,
						pointBackgroundColor: 'rgba(255, 255, 255, 0.8)',
						pointRadius: 5,
						pointHoverRadius: 7
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						y: {
							beginAtZero: false,
							min: 0,
							max: 6,
							ticks: {
								callback: function(value) {
									return getMoodText(value);
								},
								stepSize: 1
							},
							grid: {
								color: 'rgba(255, 255, 255, 0.1)'
							}
						},
						x: {
							grid: {
								color: 'rgba(255, 255, 255, 0.1)'
							}
						}
					},
					plugins: {
						legend: {
							display: false
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									return '情绪: ' + getMoodText(context.raw);
								}
							}
						}
					}
				}
			});
			
			updateMoodChart();
		}

		function updateMoodChart() {
			const records = JSON.parse(localStorage.getItem('moodRecords') || '[]');
			
			// 按日期排序
			records.sort((a, b) => a.timestamp - b.timestamp);
			
			const labels = records.map(r => {
				const date = new Date(r.timestamp);
				return date.toLocaleDateString();
			});
			
			const data = records.map(r => r.mood);
			
			moodChart.data.labels = labels;
			moodChart.data.datasets[0].data = data;
			moodChart.update();
		}

		// 抑郁症测试功能
		function calculateTestResult() {
			let totalScore = 0;
			
			// 计算每题得分
			for (let i = 1; i <= 9; i++) {
				const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
				if (selectedOption) {
					totalScore += parseInt(selectedOption.value);
				} else {
					alert(`请回答问题 ${i}`);
					return;
				}
			}
			
			// 显示结果
			const result = testResults.find(r => 
				totalScore >= r.scoreRange[0] && totalScore <= r.scoreRange[1]
			);
			
			const resultText = document.getElementById('resultText');
			const resultSuggestion = document.getElementById('resultSuggestion');
			const testResultDiv = document.getElementById('testResult');
			
			resultText.textContent = `您的得分: ${totalScore}。${result.text}`;
			resultSuggestion.textContent = result.suggestion;
			testResultDiv.style.display = 'block';
			
			// 滚动到结果
			testResultDiv.scrollIntoView({ behavior: 'smooth' });
		}

		// 心理咨询功能
		async function sendChatMessage() {
			const chatInput = document.getElementById('chatInput');
			const message = chatInput.value.trim();
			
			if (!message) return;
			
			// 添加用户消息到聊天界面
			addChatMessage(message, 'user');
			chatInput.value = '';
			
			// 显示加载状态
			const sendBtn = document.getElementById('sendMessage');
			sendBtn.innerHTML = '<div class="loading"></div>';
			
			try {
				// 调用DeepSeek API
				const response = await fetch('https://api.deepseek.com/chat/completions', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
						'Authorization': 'Bearer sk-aa329e5a0d53417b8e0632ddeda5fde1'
					},
					body: JSON.stringify({
						model: 'deepseek-chat',
						messages: [
							{
								role: 'system',
								content: '你是一名由KSF自主研发的专业心理咨询师，拥有多年临床经验。请用温暖、专业的方式回答用户的问题，提供有科学依据的心理健康建议。'
							},
							{
								role: 'user',
								content: message
							}
						],
						stream: false
					})
				});
				
				const data = await response.json();
				const botReply = data.choices[0].message.content;
				
				// 添加机器人回复到聊天界面
				addChatMessage(botReply, 'bot');
			} catch (error) {
				console.error('API调用错误:', error);
				addChatMessage('抱歉，暂时无法连接到心理咨询师。请稍后再试。', 'bot');
			} finally {
				// 恢复发送按钮
				sendBtn.innerHTML = `
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<line x1="22" y1="2" x2="11" y2="13"></line>
						<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
					</svg>
				`;
			}
		}

		function addChatMessage(message, sender) {
			const chatContainer = document.getElementById('chatContainer');
			const messageDiv = document.createElement('div');
			messageDiv.classList.add('message');
			messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
			messageDiv.textContent = message;
			chatContainer.appendChild(messageDiv);
			
			// 滚动到底部
			chatContainer.scrollTop = chatContainer.scrollHeight;
		}
	</script>
</body>
</html>